<div class="time-sheet">
  <table>
    <thead>
      <tr>
        <th class="project-col">Projets/Actions</th>
        <th *ngFor="let day of weekDays; trackBy: trackByDate" [class.weekend]="day.isWeekend" [class.today]="day.isToday">
          {{ day.name }}<br>
          {{ formatDate(day.date) }}
        </th>
        <th class="total-col">Total Semaine</th>
        <th class="total-col">Total Ann√©e</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let project of projects; trackBy: trackById">
        <!-- Project Row -->
        <tr>
          <td class="project-name" colspan="8">{{ project.name }}</td> <!-- Project name row spans across 8 columns -->
          <td class="total-week"></td>
          <td class="total-year"></td>
        </tr>

        <!-- Actions Rows under each project -->
        <ng-container *ngFor="let action of project.actions; trackBy: trackById">
          <tr>
            <td class="action-name" [matTooltip]="action.description">
              {{ action.name }}
            </td>
            <!-- Saisie des heures par jour pour chaque action -->
            <td *ngFor="let day of weekDays; trackBy: trackByDate">
              <input
                type="number"
                [ngModel]="getTimeEntry(project.id, action.id, day.date).hours"
                (ngModelChange)="updateTimeEntry($event, project.id, action.id, day.date)"
                [id]="getInputId(project.id, action.id, day.date)"
                step="0.25"
              >
            </td>
            <td class="total-week">
              {{ calculateWeekTotal(project.id, action.id) }}
            </td>
            <td class="total-year">
              {{ calculateYearTotal(project.id, action.id) }}
            </td>
          </tr>
        </ng-container>
      </ng-container>

      <!-- Fixed rows (e.g., Absence, Service, Formation) -->
      <tr *ngFor="let fixedRow of fixedRows; trackBy: trackById">
        <td class="fixed-name">{{ fixedRow.name }}</td>
        <td *ngFor="let day of weekDays; trackBy: trackByDate" [class.weekend]="day.isWeekend" [class.today]="day.isToday">
          <input
            type="number"
            [ngModel]="getTimeEntry(fixedRow.id, 0, day.date).hours"
            (ngModelChange)="updateTimeEntry($event, fixedRow.id, 0, day.date)"
            step="0.25"
          >
        </td>
        <td class="total-week">
          {{ calculateWeekTotal(fixedRow.id, 0) }}
        </td>
        <td class="total-year">
          {{ calculateYearTotal(fixedRow.id, 0) }}
        </td>
      </tr>

      <!-- Totaux quotidiens -->
      <tr class="daily-total-row">
        <td>Total jour</td>
        <td *ngFor="let day of weekDays; trackBy: trackByDate" [class.weekend]="day.isWeekend" [class.today]="day.isToday">
          {{ calculateDayTotal(day.date) }}
        </td>
        <td colspan="2"></td>
      </tr>
    </tbody>
  </table>
</div>
